# 주문 유형 설계 (Order Types)

## 개요
Olulo MX 플랫폼은 멕시코 음식 배달 시장의 다양한 주문 방식을 지원하기 위해 4가지 주문 유형을 정의합니다.

## 주문 유형 정의

### 1. 테이블 오더 (table)
**목적**: 매장 내 착석 고객의 주문
**흐름**: 착석 → 메뉴 주문 → 조리 → 서빙 → 결제 → 완료
**특징**:
- QR 코드 또는 태블릿을 통한 주문
- 테이블 번호 필수
- 실시간 주문 상태 표시
- 추가 주문 가능

### 2. 픽업 (pickup)
**목적**: 고객이 직접 매장에서 수령
**흐름**: 온라인 주문 → 결제 → 조리 → 픽업 대기 → 수령 완료
**특징**:
- 사전 주문 및 결제
- 픽업 시간 예약 가능
- SMS/WhatsApp 알림

### 3. 배달 (delivery)
**목적**: 배달원을 통한 고객 주소 배송
**흐름**: 온라인 주문 → 결제 → 조리 → 배달원 할당 → 배달 중 → 완료
**특징**:
- 실시간 배달 추적
- GPS 기반 위치 확인
- 배달비 및 팁 처리

### 4. 예약 (reservation)
**목적**: 미래 시점의 테이블 예약 및 사전 주문
**흐름**: 예약 신청 → 승인 → 사전 주문 → 방문 → 서빙 → 완료
**특징**:
- 테이블 예약 시스템 연동
- 사전 메뉴 선택 옵션
- 예약 확정/취소 알림

## 상태 머신 정의

### 공통 상태
- `pending`: 주문 접수 대기
- `accepted`: 매장 승인
- `preparing`: 조리 중
- `completed`: 완료
- `canceled`: 취소
- `refunded`: 환불

### 유형별 특수 상태

#### 테이블 오더
- `served`: 서빙 완료 (결제 전)

#### 픽업
- `ready_for_pickup`: 픽업 대기

#### 배달
- `ready_for_pickup`: 픽업 대기
- `out_for_delivery`: 배달 중

#### 예약
- `confirmed`: 예약 확정
- `arrived`: 고객 도착

## 비즈니스 규칙

### 취소 정책
- **테이블**: 서빙 전까지 취소 가능
- **픽업**: 조리 시작 전까지 취소 가능
- **배달**: 배달원 할당 전까지 취소 가능
- **예약**: 예약 시간 2시간 전까지 취소 가능

### 결제 시점
- **테이블**: 서빙 후 결제
- **픽업**: 주문 시 선결제
- **배달**: 주문 시 선결제
- **예약**: 예약 시 보증금, 방문 시 잔금

### 알림 정책
- **WhatsApp Business API** 우선 사용
- SMS 백업 알림
- 실시간 상태 업데이트

## 멕시코 시장 특화사항

### 결제 연동
- **operacionesenlinea.com** 게이트웨이
- 멕시코 페소(MXN) 기본 통화
- 현금 결제 옵션 (배달/픽업)

### 문화적 고려사항
- 가족 단위 대형 주문 지원
- 축제/이벤트 대량 예약 처리
- 스페인어 음성 주문 지원 (향후)

## 기술적 구현 고려사항

### 데이터베이스 설계
```sql
-- orders 테이블 order_type 필드
order_type ENUM('table', 'pickup', 'delivery', 'reservation')

-- 상태별 인덱스 최적화
INDEX idx_order_type_status (order_type, status)
INDEX idx_store_order_type (store_id, order_type)
```

### API 설계
- 주문 유형별 별도 엔드포인트
- 상태 전환 검증 로직
- 실시간 이벤트 처리

### 확장성 고려
- 새로운 주문 유형 추가 가능한 구조
- 지역별 특화 상태 추가 지원
- 다국가 확장 대비 설계

## 참조 문서
- [주문 테이블 스키마](../models/tables/orders.md)
- [결제 시스템 설계](../payments/operacionesenlinea.md)
- [알림 시스템 설계](../notifications/whatsapp-business.md)
- [매장 관리 워크플로우](../workflows/restaurant-management.md)