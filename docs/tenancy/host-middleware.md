# 테넌시 — 호스트 기반 미들웨어 설계(프로젝트 1)

## 목적
- 서브도메인(예: `menu.dev.olulo.com.mx`)의 호스트로 매장을 식별(`stores.code`)하여 요청 컨텍스트에 `tenant(store_id)`를 주입
- 모든 쿼리를 `store_id`로 스코핑하는 기반 마련

## 동작 개요
1) 요청의 Host 헤더 파싱 → `subdomain.env.olulo.com.mx` 패턴에서 `subdomain` 추출
2) `stores.code=subdomain` 조회
3) 컨텍스트 바인딩: `app()->instance('tenant', ['store_id' => <id>, 'code' => subdomain])`
4) 글로벌 스코프 혹은 리포지토리 레벨에서 `store_id` 조건 주입

## 라우트 적용(개념)
- 고객 페이지(React) API 그룹, QR 검증, 메뉴 조회/주문 생성 등
- 관리자(필요 시 그룹/매장 고정 컨텍스트가 있을 때만)

## 예외 처리
- 매칭 실패 시 404 또는 지정된 기본 매장 라우팅
- 상위 도메인으로 직접 접근 시 차단 또는 랜딩 페이지로 리다이렉트

## 테스트 포인트
- 존재하는 매장 서브도메인으로 접근 시 컨텍스트 주입 확인
- 존재하지 않는 서브도메인 접근 시 404
- 멀티테넌시 스코프가 누락된 엔드포인트 탐지(로깅)
