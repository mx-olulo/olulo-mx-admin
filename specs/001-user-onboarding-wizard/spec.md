# 기능 명세: 사용자 온보딩 위자드

**기능 브랜치**: `001-user-onboarding-wizard`
**생성일**: 2025-10-19
**상태**: 초안
**입력**: 사용자 설명: "사용자 온보딩 시나리오를 최소한으로만 구현한다. 소속이 없는 사용자가 로그인 한 경우 조직, 매장 중 하나를 Filament V4 위자드 기능으로 생성해서 해당 영역에 Role 을 생성해서 랜딩한다."

## Clarifications

### Session 2025-10-19

- Q: 조직-매장 관계 구조는? → A: 조직과 매장은 완전히 독립적이며, 매장이 조직 없이 존재 가능. 매장은 나중에 조직에 소속될 수 있음. 독립 매장, 가맹점, 체인점, 직영점을 모두 커버.
- Q: 온보딩 완료 조건 및 재진입 정책은? → A: 조직 또는 매장 생성 후 해당 조직/매장에 생성자 또는 소유자로서 Role을 가져야 온보딩 완료. 사용자의 모든 소속이 사라져 Role이 없으면 위자드 재진입 필요.
- Q: 조직/매장 생성 시 필수 입력 필드는? → A: 이름만 필수. 2단계 온보딩: 1단계는 빠른 생성(이름만), 2단계는 추가 정보 입력 후 심사를 통해 나머지 기능 활성화.
- Q: 위자드 중단 후 재진입 시 이전 입력 데이터 처리는? → A: 입력 데이터 보존하지 않음. 매번 새로 시작. 이름만 입력하므로 복잡도 불필요.
- Q: 온보딩 위자드 진입 시점 및 강제성은? → A: 로그인 직후 자동 표시, 우회 불가. Role 없이는 시스템 사용 불가능하므로 온보딩은 필수.

## 사용자 시나리오 & 테스팅 *(필수)*

### 사용자 스토리 1 - 소속 없는 사용자의 첫 로그인 처리 (우선순위: P1)

신규 사용자가 처음 로그인했을 때, 소속된 조직이나 매장이 없는 경우 시스템이 자동으로 온보딩 위자드를 표시하여 사용자가 조직 또는 매장을 생성하고 해당 영역에서 작업을 시작할 수 있도록 합니다.

**우선순위 이유**: 소속이 없는 사용자는 시스템을 사용할 수 없으므로, 온보딩 프로세스는 첫 사용자 경험의 핵심입니다.

**독립 테스트**: 소속이 없는 테스트 사용자로 로그인하여 위자드가 표시되고, 조직 또는 매장을 생성한 후 해당 영역으로 랜딩되는지 확인할 수 있습니다.

**수락 시나리오**:

1. **Given** 소속이 없는 사용자가 인증되었을 때, **When** 시스템에 로그인하면, **Then** 온보딩 위자드 화면이 자동으로 표시됨
2. **Given** 온보딩 위자드가 표시되었을 때, **When** 사용자가 "조직 생성" 또는 "매장 생성" 중 하나를 선택하면, **Then** 해당 생성 단계로 진행됨
3. **Given** 사용자가 조직 생성을 완료했을 때, **When** 위자드가 종료되면, **Then** 생성된 조직의 관리자 역할이 자동으로 부여되고 조직 대시보드로 랜딩됨
4. **Given** 사용자가 매장 생성을 완료했을 때, **When** 위자드가 종료되면, **Then** 생성된 매장의 관리자 역할이 자동으로 부여되고 매장 대시보드로 랜딩됨

---

### 사용자 스토리 2 - 위자드를 통한 조직 생성 (우선순위: P1)

사용자가 온보딩 위자드에서 "조직 생성"을 선택하면, 조직 이름(필수)을 입력하여 새 조직을 생성할 수 있습니다. 추가 정보는 온보딩 후 입력 가능합니다.

**우선순위 이유**: 조직 생성은 온보딩의 핵심 경로 중 하나이며, 사용자가 시스템을 사용하기 위한 필수 단계입니다.

**독립 테스트**: 위자드에서 조직 생성 플로우만 단독으로 테스트하여 유효성 검증, 데이터 저장, 역할 부여가 정상적으로 작동하는지 확인할 수 있습니다.

**수락 시나리오**:

1. **Given** 사용자가 "조직 생성"을 선택했을 때, **When** 조직 이름(필수)을 입력하면, **Then** 입력 값이 유효성 검증됨
2. **Given** 유효한 조직 이름이 입력되었을 때, **When** "완료" 버튼을 클릭하면, **Then** 조직이 생성되고 사용자에게 생성자/소유자 역할이 부여됨
3. **Given** 조직 생성이 완료되었을 때, **When** 위자드가 닫히면, **Then** 사용자는 생성된 조직의 대시보드로 이동됨

---

### 사용자 스토리 3 - 위자드를 통한 매장 생성 (우선순위: P1)

사용자가 온보딩 위자드에서 "매장 생성"을 선택하면, 매장 이름(필수)을 입력하여 새 매장을 생성할 수 있습니다. 주소, 영업 시간 등의 세부 정보는 온보딩 후 추가 입력하여 심사를 통해 전체 기능을 활성화할 수 있습니다.

**우선순위 이유**: 매장 생성은 온보딩의 또 다른 핵심 경로이며, 매장 운영자가 시스템을 사용하기 위한 필수 단계입니다. 2단계 온보딩을 통해 빠른 시작과 기능 활성화를 분리합니다.

**독립 테스트**: 위자드에서 매장 생성 플로우만 단독으로 테스트하여 유효성 검증, 데이터 저장, 역할 부여가 정상적으로 작동하는지 확인할 수 있습니다.

**수락 시나리오**:

1. **Given** 사용자가 "매장 생성"을 선택했을 때, **When** 매장 이름(필수)을 입력하면, **Then** 입력 값이 유효성 검증됨
2. **Given** 유효한 매장 이름이 입력되었을 때, **When** "완료" 버튼을 클릭하면, **Then** 매장이 생성되고 사용자에게 생성자/소유자 역할이 부여됨
3. **Given** 매장 생성이 완료되었을 때, **When** 위자드가 닫히면, **Then** 사용자는 생성된 매장의 대시보드로 이동됨
4. **Given** 매장이 생성되었을 때, **When** 대시보드에 진입하면, **Then** 추가 정보 입력 안내가 표시되어 세부 정보를 완성할 수 있음

---

### 사용자 스토리 4 - 위자드 중단 및 재진입 처리 (우선순위: P2)

사용자가 온보딩 위자드를 완료하지 않고 중단한 경우, 다음 로그인 시 위자드가 다시 표시되어 온보딩을 완료할 수 있도록 합니다.

**우선순위 이유**: 사용자가 온보딩을 완료하지 않으면 시스템을 사용할 수 없으므로, 재진입 처리는 사용자 경험 향상에 중요합니다.

**독립 테스트**: 위자드를 중단한 후 재로그인하여 위자드가 다시 표시되는지 확인할 수 있습니다.

**수락 시나리오**:

1. **Given** 사용자가 온보딩 위자드를 완료하지 않았을 때, **When** 로그아웃 후 다시 로그인하면, **Then** 온보딩 위자드가 다시 표시됨
2. **Given** 사용자가 온보딩을 완료했을 때, **When** 로그아웃 후 다시 로그인하면, **Then** 온보딩 위자드가 표시되지 않고 일반 대시보드로 이동됨

---

### 엣지 케이스

- 사용자가 유효한 Role(생성자 또는 소유자)을 보유한 경우 온보딩 위자드를 표시하지 않습니다.
- 사용자가 조직/매장 생성 후 Role 부여 전에 세션이 중단된 경우, Role이 없으므로 재로그인 시 위자드가 다시 표시됩니다.
- 위자드 중단 후 재진입 시 이전 입력 데이터는 보존되지 않으며, 매번 처음부터 새로 시작합니다.
- 사용자가 조직과 매장을 동시에 생성하려고 시도하는 경우 하나만 선택하도록 제한합니다.
- 조직 또는 매장 이름이 이미 존재하는 경우 오류 메시지를 표시하고 다른 이름을 입력하도록 안내합니다.
- 사용자의 모든 소속(Role)이 삭제되거나 제거된 경우, 재로그인 시 위자드가 다시 표시되어 새로운 조직 또는 매장을 생성할 수 있습니다.

## 요구사항 *(필수)*

### 기능 요구사항

- **FR-001**: 시스템은 반드시 사용자 로그인 시 유효한 Role(생성자 또는 소유자) 보유 여부를 확인해야 함
- **FR-002**: 시스템은 반드시 유효한 Role이 없는 사용자에게 로그인 직후 온보딩 위자드를 자동으로 표시해야 하며, 우회할 수 없어야 함
- **FR-003**: 사용자는 반드시 온보딩 위자드에서 "조직 생성" 또는 "매장 생성" 중 하나를 선택할 수 있어야 함
- **FR-004**: 시스템은 반드시 조직 또는 매장 이름(필수 필드)을 유효성 검증해야 함. 추가 정보는 선택적
- **FR-005**: 시스템은 반드시 조직 또는 매장 생성 시 사용자에게 생성자/소유자 역할을 자동으로 부여해야 함
- **FR-006**: 시스템은 반드시 온보딩 완료(생성 + Role 부여) 후 사용자를 생성된 조직 또는 매장의 대시보드로 리디렉션해야 함
- **FR-007**: 시스템은 반드시 모든 Role을 상실한 사용자가 재로그인할 때 위자드를 다시 표시해야 함
- **FR-008**: 시스템은 반드시 유효한 Role을 보유한 사용자에게는 위자드를 표시하지 않아야 함

**Olulo Mx 원칙 고려사항**:
- 멀티테넌시: 생성된 조직과 매장은 각각 독립적인 테넌트로 격리되어야 함
- 관찰성: 온보딩 완료 시 Slack 알림 또는 로깅을 통해 모니터링 가능하도록 함

### 주요 엔티티 *(기능이 데이터를 포함하는 경우 포함)*

- **조직(Organization)**: 여러 매장을 관리할 수 있는 엔티티. 필수 속성: 이름. 선택적 속성: 생성 일시, 소유자 정보. 매장과 독립적으로 존재 가능
- **매장(Store)**: 개별 매장을 나타내는 엔티티. 필수 속성: 이름. 선택적 속성: 주소, 영업 시간, 소속 조직, 활성화 상태. 조직 없이 독립적으로 존재 가능. 독립 매장, 가맹점, 체인점, 직영점 유형 지원. 세부 정보 입력 후 심사를 통해 전체 기능 활성화
- **사용자(User)**: 시스템 사용자, 이메일, 이름, 소속 조직/매장 정보, 역할(Role) 정보 포함
- **역할(Role)**: 사용자의 권한을 정의하는 엔티티, 조직 관리자, 매장 관리자 등의 역할 유형 포함

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: 소속이 없는 사용자가 로그인 후 5분 이내에 온보딩을 완료하고 대시보드로 진입할 수 있음
- **SC-002**: 온보딩 위자드를 통해 생성된 조직 또는 매장의 100%가 올바른 관리자 역할을 부여받음
- **SC-003**: 온보딩 미완료 사용자의 100%가 재로그인 시 위자드를 다시 볼 수 있음
- **SC-004**: 온보딩 완료율이 80% 이상(사용자가 위자드를 시작한 후 완료까지 도달하는 비율)

## 가정

- 사용자는 이미 인증(Firebase 또는 Sanctum)을 통해 로그인한 상태입니다.
- 조직과 매장은 완전히 독립적인 엔티티이며, 매장은 조직 소속 없이 생성 및 운영될 수 있습니다. 매장은 나중에 조직에 소속될 수 있습니다.
- 온보딩 위자드는 Filament V4의 Wizard 컴포넌트를 사용하여 구현됩니다.
- 역할(Role) 시스템은 이미 구현되어 있으며, 생성자/소유자 역할이 정의되어 있습니다.
- 온보딩 시 사용자는 조직 또는 매장 중 하나만 생성할 수 있습니다.
- 온보딩은 2단계로 구성됩니다: 1단계(이름만 입력하여 빠른 생성), 2단계(추가 정보 입력 후 심사를 통한 기능 활성화).

## 종속성

- 인증 시스템(Firebase + Sanctum SPA 세션)이 구현되어 있어야 합니다.
- 조직 및 매장 모델과 데이터베이스 스키마가 정의되어 있어야 합니다.
- 역할 및 권한 관리 시스템(RBAC)이 구현되어 있어야 합니다.
- Filament V4 Panel 및 Dashboard 구조가 설정되어 있어야 합니다.

